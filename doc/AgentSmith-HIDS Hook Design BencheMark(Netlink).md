# AgentSmith-HIDS Hook Design BencheMark(Netlink)		

| 测试服务器 |                                                              |
| ---------- | ------------------------------------------------------------ |
| Server1    | OS: GNU/Linux -- 3.10.0-862.14.4.el7.x86_64  Machine: x86_64 (x86_64)<br/>CPU(4): Intel(R) Core(TM) i7-4870HQ CPU @ 2.50GHz (4989.4 bogomips) |
| Server2    | OS: GNU/Linux -- 3.10.0-862.11.6.el7.x86_64 Machine: x86_64 (x86_64)<br/>CPU(4): Intel(R) Core(TM) i7-7700K CPU @ 4.20GHz (8395.4 bogomips) |



#### 一:ktime检测connect syscall耗时

测试服务器:Server2

测试工具:wrk 4.1.0

测试环境:wrk -c60 -d3600 -t4



测试一:NO Hook,测试connect的耗时

| 总请求数     | 50058828  |
| ------------ | --------- |
| QPS          | 13904.92  |
| 平均耗时(ns) | 46660.37  |
| 中位数(ns)   | 40945.0   |
| 99分位(ns)   | 194202.96 |
| 95分位(ns)   | 111715.35 |
| 90分位(ns)   | 87400.7   |
| 80分位(ns)   | 67464.4   |
| 70分位(ns)   | 56735.0   |



测试二:Hook,测试Hook方案本身的耗时

| 总请求数     | 49856927 | Loss(%) |
| ------------ | -------- | ------- |
| QPS          | 13848.91 | NULL    |
| 平均耗时(ns) | 16540.36 | 35.44%  |
| 中位数(ns)   | 11558.0  | 28.22%  |
| 99分位(ns)   | 82464.19 | 42.44%  |
| 95分位(ns)   | 33077.35 | 29.60%  |
| 90分位(ns)   | 24865.0  | 28.44%  |
| 80分位(ns)   | 21051.0  | 31.20%  |
| 70分位(ns)   | 19114.0  | 33.68%  |



#### 二:Hook稳定性/性能测试

测试服务器:Server2

测试工具:wrk 4.1.0; sysstat 10.1.5

测试环境:wrk -c40 -d3600 -t4

​		30 * while(true) uname



wrk数据:

| 总请求数     | 46746746 |
| ------------ | -------- |
| QPS          | 12984.88 |
| Transfer/sec | 10.53MB  |



CPU占用(usr+system+guest):

| 最大值 | 11.0% |
| ------ | ----- |
| 最小值 | 5.94% |
| 均值   | 7.94% |



Mem占用:

| 物理内存(RSS) | 稳定676KB  |
| ------------- | ---------- |
| 虚拟内存(VSZ) | 稳定6484KB |

(注:该测试目标为用户层接收程序的最小程序,即不包括数据传输模块,仅包含用户层和内核Agent通讯模块)